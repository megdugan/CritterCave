<!-- (CritterCave) -->
<!-- Displays a user's profile page, including their critter,
    stories, liked critters, and liked stories -->

{% extends "base.html" %}

{% block head_stuff %}
<title>Profile</title>
{% endblock %}

{% block main_content %}

    {% if session.get('uid') == user.uid %}
        <div class="profile-settings-wrapper">
            <a href="{{ url_for('settings_page', uid=user.uid) }}" class="button-primary profile-settings-button">Settings</a>
        </div>
    {% endif %}

    <div  id="main" class="main">
        <!-- Profile Header Card -->
        <section class="critter-header-card">
            <div class="critter-info-left">
                {% if user.profilepic %}
                <img src="{{  url_for('uploaded_file', filename=user.profilepic) }}"
                    alt="Profile Picture" class="critter-profile-img">
                {% endif %}
            </div>

            <div class="critter-info-right">
                <h1 class="critter-name">{{ user.name }}</h1>
                <h4>@{{ user.username }}</h4>
                <h4>{{ user.created }}</h4>
                <a href="{{ url_for('critter_upload') }}"
                class="button-primary write-story-btn">
                Create a new critter
                </a>
            </div>
        </section>

        <div class="tab-container">
            <button class="tablink" onclick="openPage('Critters', this, 'var(--accent-rosewood)')" id="defaultOpen">Critters</button>
            <button class="tablink" onclick="openPage('Stories', this, 'var(--accent-rosewood)')">Stories</button>
            <button class="tablink" onclick="openPage('Liked_Critters', this, 'var(--accent-rosewood)')">Liked Critters</button>
            <button class="tablink" onclick="openPage('Liked_Stories', this, 'var(--accent-rosewood)')">Liked Stories</button>
        </div>

        <div id="Critters" class="tabcontent">
            {% if critters %}
            <div class="critter-grid">
                {% for critter in critters %}
                <div>
                    <a href="{{ url_for('critter_page', cid=critter.cid) }}" class="critter-card">
                        <img src="{{ url_for('uploaded_file', filename=critter.imagepath) }}"
                            alt="{{ critter.name }}">
                        <p>{{ critter.name }}</p>
                    </a>

                    <div class="like-btn-container">
                        <button value="like"
                                type="button"
                                class="like-btn"
                                data-cid="{{ critter.cid }}"
                                data-url="{{ url_for('like_feature', cid=critter.cid) }}"
                                aria-label="Like this critter">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                        </button>

                        <div class="like-count-display">
                            <span class="like-count">{{ critter.likes }}</span> 
                        </div>
                    </div>

                </div>
                {% endfor %}
            </div>
            {% else %}
                <p class="empty-text">No critters uploaded.</p>
            {% endif %}
        </div>

            
        <div id="Stories" class="tabcontent">
            {% if stories %}
                <section class="stories-section">
                    <div class="story-group">
                        <div class="story-card-grid">
                            {% for story in stories %}
                                <a href="{{ url_for('story_page', sid=story.sid, cid=story.cid) }}" class="story-card pastel-box story-card-link">
                                    <span class="story-author-tag">For {{ story.name }}</span>
                                    <p>{{ story.story }}</p>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                </section>
            {% else %}
                <p class="empty-text">No stories written.</p>
            {% endif %}
        </div>

        <div id="Liked_Critters" class="tabcontent">
            {% if liked_critters %}
            <div class="critter-grid">
                {% for critter in liked_critters %}
                <div>
                    <a href="{{ url_for('critter_page', cid=critter.cid) }}" class="critter-card">
                        <img src="{{ url_for('uploaded_file', filename=critter.imagepath) }}"
                            alt="{{ critter.name }}">
                        <p>{{ critter.name }}</p>
                    </a>

                    <div class="like-btn-container">
                        <button value="like"
                                type="button"
                                class="like-btn"
                                data-cid="{{ critter.cid }}"
                                data-url="{{ url_for('like_feature', cid=critter.cid) }}"
                                aria-label="Like this critter">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                        </button>

                        <div class="like-count-display">
                            <span class="like-count">{{ critter.likes }}</span> 
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
                <p class="empty-text">No critters liked yet.</p>
            {% endif %}
        </div>

        <div id="Liked_Stories" class="tabcontent">
            {% if liked_stories %}
                <section class="stories-section">
                    <div class="story-group">
                        <div class="story-card-grid">
                            {% for story in liked_stories %}
                                <a href="{{ url_for('story_page', sid=story.sid, cid=story.cid) }}" class="story-card pastel-box story-card-link">
                                    <span class="story-author-tag">For {{ story.name }}</span>
                                    <p>{{ story.story }}</p>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                </section>
            {% else %}
                <p class="empty-text">No stories liked yet.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}