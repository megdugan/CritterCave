<!-- (CritterCave) -->
<!-- Displays the critter's information and stories -->

{% extends "base.html" %}

{% block head_stuff %}
<title>Critter Page</title>
{% endblock %}

{% block main_content %}

<div class="critter-page">

    <!-- Critter Header Card -->
    <section class="critter-header-card">
        <div class="critter-info-left">
            {% if critter_info.imagepath %}
            <img src="{{ url_for('uploaded_file', filename=critter_info.imagepath) }}"
                 alt="Critter Image" class="critter-profile-img">
            {% endif %}
        </div>

        <div class="critter-info-right">
            <h1 class="critter-name">{{ critter_info.name }}</h1>
            <p class="critter-maker">
                <h4>Made by:
                <a href="{{ url_for('user_profile', uid=user.uid) }}">
                    {{ user.username }}
                </a>
                </h4>
                <h4>{{ critter_info.created }}</h4>
            </p>

            <p class="critter-description">
                {{ critter_info.description }}
            </p>

            <a href="{{ url_for('story_upload', cid=critter_info.cid) }}"
               class="button-primary write-story-btn">
               Write a Story About {{ critter_info.name }}
            </a>

            <!-- Show delete button only if the logged-in user is the creator of the critter -->
            {% if session.get('uid') == critter_info.uid %}
                <a href="{{ url_for('delete_critter', cid=critter_info.cid) }}"
                    class="button-primary write-story-btn">Delete Critter</a>
            {% endif %}
        </div>
    </section>

    <!-- Stories Section -->
    <section class="stories-section">
        <h2 class="section-title">Stories</h2>

        <div class="story-group">
            <h3 class="story-group-title">
                Stories by {{ user.username }} (creator)
            </h3>

            {% if stories %}
                <div class="story-card-grid">
                    {% for story in stories %}
                        {% if story.uid == user.uid %}
                        <div class="story-card pastel-box">
                            <a href="{{ url_for('story_page', sid=story.sid, cid=critter_info.cid) }}"
                            class="story-card-link">
                            <p>{{ story.critter_story }}</p>

                            <div class="like-btn-story">
                                <button value="like"
                                        type="button"
                                        class="like-btn"
                                        data-sid="{{ story.sid }}"
                                        data-story="{{ url_for('like_story_feature', sid=story.sid) }}"
                                        aria-label="Like this critter">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>

                                    <div class="like-count-display-story" >
                                    <span class="like-count-story">{{ story.story_likes }}</span> 
                                    </div>
                                </button>
                            </div>
                            </a>

                            
                        </div>
                        {% endif %}
                    {% endfor %}
                    </div>

            {% else %}
                <p class="empty-text">No stories written by this author.</p>
            {% endif %}
        </div>

        <div class="story-group">
            <h3 class="story-group-title">
                Stories by other users
            </h3>

            {% if stories %}
                <div class="story-card-grid">
                    {% for story in stories %}
                        {% if story.uid != user.uid %}
                        <div class="story-card pastel-box">
                            <a href="{{ url_for('story_page', sid=story.sid, cid=critter_info.cid) }}" 
                            class="story-card-link">
                                <p>{{ story.critter_story }}</p>
                                <a href="{{ url_for('user_profile', uid=story.uid) }}">
                                    By {{story.username}}
                                </a>

                                <div class="like-btn-story">
                                <button value="like"
                                        type="button"
                                        class="like-btn"
                                        data-sid="{{ story.sid }}"
                                        data-story="{{ url_for('like_story_feature', sid=story.sid) }}"
                                        aria-label="Like this critter">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>

                                    <div class="like-count-display-story" >
                                    <span class="like-count-story">{{ story.story_likes }}</span> 
                                    </div>
                                </button>
                                </div>
                            </a>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <!-- Show be the first button only if the user is not the creator. -->
                {% if session.get('uid') == critter_info.uid %}
                    <p class="empty-text">No stories written yet.</p>
                {% else %}
                    <a href="{{ url_for('story_upload', cid=critter_info.cid) }}"
                        class="button-primary write-story-btn">
                        Write the First Story About {{ critter_info.name }}
                    </a>
                {% endif %}
            {% endif %}
        </div>

    </section>
</div>

{% endblock %}
